{% extends "layout.html" %}
{% block header %}
  <link rel="stylesheet" type="text/css" href="{{url_for('statics', rtype='css', filename='select2.min.css')}}">
  <script src="{{url_for('statics', rtype='js', filename='select2.min.js')}}"></script>
{% endblock %}
{% block title %}Object detail{% endblock %}

{% block content %}
{% if 'all' in session['rights'] or 'objects' in session['rights'] %}
<!-- Panel -->
<div class="panel panel-default">
  <form role="addnewobject" action="{{ url_for('add_object') }}" method="POST" enctype="multipart/form-data">
    <!-- Object Header -->
    <div class="row">
      <div class="col-md-3">
        <!-- Object ID Image -->
        <p>
          <div class="input-group">
            <span class="input-group-addon">Object ID</span>
            <input class="form-control" type="text" name="id" value="{{object.id}}" maxlength="10" autofocus>
          </div>
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 col-md-offset-2">
        <p>
          <img class="img-thumbnail" src="{{ url_for('get_file',rtype='images',filename=object.id + '.png') }}">
        </p>
        <!-- Upload Image -->
        <input id="uploadImage" placeholder="Choose File" disabled="disabled">
        <div class="fileUpload btn btn-sm btn-primary">
          <span>Browse</span>
          <input id="uploadImageBtn" type="file" name="imagefile" class="upload">
        </div>
      </div>
      <div class="col-md-3 col-md-offset-1">
        <img class="img-thumbnail" src="{{ url_for('qrcode',data=object.id) }}">
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
      </div>
    </div>

    <!-- Ipput Translations -->
    <div class="row">
      {% for translation in object.translations %}
      <div class="col-md-4">
        <div class="list-group">
          <div class="list-group-item list-group-item-info">
            Language:
            <strong>
            {% for language in languages | sort %}
              {% if language.code + '-' + language.locale == translation.isocode %}
                {{language.variant}} / {{language.name}}
              {% endif %}
            {% endfor %}
          </strong>
          </div>
          <div class="list-group-item">
            <div class="input-group">
              <span class="input-group-addon">Title</span>
              <input class="form-control" name="translation[{{translation.isocode}}]" value="{{translation.title}}">
            </div>
            <div class="input-group">
              <span class="input-group-addon">Text</span>
              <textarea class="form-control" name="translation[{{translation.isocode}}]">{{translation.title}}</textarea>
            </div>
            <div class="list-group-item">
                <label>Audio</label>
                {% if translation.audio == True %}
                <audio controls="controls" preload="metadata" src="{{ url_for('get_file', rtype='audios', filename=translation.isocode + '-' + object.id + '.mp3') }}">
                  Your browser doesn't support Audio TAG
                </audio>
                {% else %}
                <span class="label label-danger">No</span>
                {% endif %}
                <!-- Upload Image -->
                <input id="uploadAudio_{{translation.isocode}}" placeholder="Choose File" disabled="disabled">
                <div class="fileUpload btn btn-sm btn-primary">
                  <span>Browse</span>
                  <input id="uploadAudio_{{translation.isocode}}_Btn" type="file" name="audiofile_{{translation.isocode}}" class="upload">
                </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <p>
      <a href="{{ url_for('objects') }}" class="btn btn-primary">Cancel</a>
      <input type="submit" class="btn btn-danger" value="Save changes">
    </p>
  </form>
</div>

{% set current_translations = languages | count %}
<script type="text/javascript">
$(document).ready(function() {
  $(".js-example-basic-single").select2();

  document.getElementById("uploadBtn").onchange = function () {
    document.getElementById("uploadFile").value = this.value;
  };

  /*
    Original idea:
    http://www.sanwebe.com/2013/03/addremove-input-fields-dynamically-with-jquery
  */
  var max_fields      = {{current_translations}}; //maximum input boxes allowed
  var wrapper         = $(".input_fields_wrap"); //Fields wrapper
  var add_button      = $(".add_field_button"); //Add button ID

  var x = 1; //initlal text box count
  $(add_button).click(function(e) { //on add input button click
    e.preventDefault();
    if (x < max_fields) { //max input box allowed
      x++; //text box increment
      $(wrapper).append('<div><a href="#" class="remove_field btn btn-sm btn-danger">Remove Translation</a> \
      <div class="input-group"> \
        <span class="input-group-addon">Translation</span> \
        <select \
          name="translations['+ x.toString() +']" \
          id="translations1" \
          class="js-example-basic-single" \
          id="isocode"> \
          {% for translation in languages %} \
          {% set isocode = translation.code + '-' + translation.locale %} \
          <option value="{{isocode}}">{{translation.name}} / {{translation.variant}}</option> \
          {% endfor %} \
        </select>\
      </div> \
      <div class="input-group"> \
        <span class="input-group-addon">Title</span> \
        <input class="form-control" name="translations['+ x.toString() +']" type="text" required><br> \
        </div> \
        <div class="input-group"> \
        <span class="input-group-addon">Text</span> \
        <input class="form-control" name="translations['+ x.toString() +']" type="text" required> \
        </div></div><p></p>'); //add input box
      $(".js-example-basic-single").select2();
    }
  });

  $(wrapper).on("click",".remove_field", function(e) { //user click on remove text
    e.preventDefault();
    $(this).parent('div').remove();
    x--;
  })
});
</script>

{% else %}
<div class="alert alert-danger" align="center" style="max-width: 400px;">
  <p>You don't have permission to view this page.</p>
</div>
{% endif %}
{% endblock %}
