{% extends "layout.html" %}
{% block title %}Objects{% endblock %}

{% block content %}
  <p>
    <a class="button" onclick="$('#add_object_div').toggle();">Add Object</a><br>
  </p>
  <div id="add_object_div" hidden>
    {% set lastobj = objects | last() %}
    {% set newid = '%010d' % (lastobj.id | int + 1) %}
    <form id="add_object" action="{{url_for('change_object')}}" method="POST">
      <input type="hidden" name="action" value="add_object">
      <p>
        Insert Object ID: <input type="text" size="10" maxlength="10" name="id" value="{{newid}}">
        <a class="button" onclick="$('#add_object').submit();">Save</a>
      </p>
    </form>
  </div>
  <table width="95%">
    <tr>
      <th>Object ID</th>
      <th>Object Image</th>
      <th>Object Texts</th>
    </tr>
    {% for object in objects %}
    <tr>
      <td>
        <form id="change_oid_{{object.id}}" action="{{url_for('change_object')}}" method="POST">
          <input name="objectid" size="10" maxlength="10" type="text" value="{{object.id}}"><br>
          <input type="hidden" name="_id" value="{{object._id}}">
          <input id="id_action_{{object.id}}" type="hidden" name="action" value="change">
          <p><a class="button" onclick="$('#change_oid_{{object.id}}').submit();">Save</a></p>
          <a class="button" onclick="
            $('#id_action_{{object.id}}').val('del_object');
            $('#change_oid_{{object.id}}').submit();">Remove</a>
        </form>
      </td>
      <td>
        <table align="center" width="100%">
          <tr>
            <th>Image</th>
            <th>Qr Code</th>
          <tr>
            <td><img src="/thumbs/{{object.id}}.png"></td>
            <td><img src="/qrcode/{{object.id}}.svg"></td>
          </tr>
        </table>
        <form id="upload_image_{{object.id}}" action="{{url_for('upload_obj_img',filename=object.id)}}" method="post" enctype="multipart/form-data">
          <input class="button" type="file" name="file"><br>
            <p><a class="button" onclick="$('#upload_image_{{object.id}}').submit()">Upload</a></p>
        </form>
      </td>
      <td>
        <table width="100%">
          <tr>
            <th>ISO Code</th>
            <th>Title</th>
            <th>Text</th>
            <th>Action</th>
          </tr>
          {% for lang in object.translations %}
          <tr>
            <form action="{{url_for('change_object')}}" method="POST" id="text_{{object.id}}_{{lang.isocode}}">
              <input type="hidden" name="_id" value="{{object._id}}">
              <input type="hidden" id="action_{{object.id}}_{{lang.isocode}}" name="action" value="change">
              <td><input name="isocode" size="5" maxlength="5" type="text" value="{{lang.isocode}}"></td>
              <td><input name="title" size="30" type="text" value="{{lang.title}}"></td>
              <td><textarea name="text" cols="60">{{lang.text}}</textarea></td>
              <td>
                <p><a class="button" onclick="$('#text_{{object.id}}_{{lang.isocode}}').submit();">Save</a></p>
                <p><a class="button" onclick="$('#action_{{object.id}}_{{lang.isocode}}').val('del_trans');
                $('#text_{{object.id}}_{{lang.isocode}}').submit();">Remove</a></p>
              </td>
            </form>
          </tr>
          {% endfor %}
          <tr id="translation_{{object.id}}" hidden>
            <form action="{{url_for('change_object')}}" method="POST" id="add_translation_{{object.id}}">
              <input type="hidden" name="_id" value="{{object._id}}">
              <input type="hidden" name="action" value="change">
              <td>
                <select name="isocode">
                  {% for code in langs %}
                  <option value="{{code}}">{{code}}</option>
                  {% endfor %}
                </select>
              </td>
              <td><input name="title" size="30" type="text"</td>
              <td><textarea name="text" cols="60"></textarea></td>
              <td>
                <a class="button" onclick="$('#add_translation_{{object.id}}').submit();">Save</a>
              </td>
            </form>
          </tr>
        </table>
        <p><a class="button" onclick="$('#translation_{{object.id}}').toggle()">Add more</a></p>
      </td>
    </tr>
    {% endfor %}
  </table>
{% endblock %}
